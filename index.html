<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8 />
    <title>ExquisiteWarps beta AF</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link href="../css/playlist.css" rel="stylesheet" />

    <script type="text/javascript" src="../js/waveform_playlist.js"></script>
    <script type="text/javascript" src="../js/waveform/mixins/mixin.js"></script>
    <script type="text/javascript" src="../js/waveform/mixins/observer.js"></script>
    <script type="text/javascript" src="../js/waveform/mixins/conversions.js"></script>
    <script type="text/javascript" src="../js/waveform/mixins/curves.js"></script>
    <script type="text/javascript" src="../js/waveform/states/file_drop.js"></script>
    <script type="text/javascript" src="../js/waveform/states/cursor.js"></script>
    <script type="text/javascript" src="../js/waveform/states/fadein.js"></script>
    <script type="text/javascript" src="../js/waveform/states/fadeout.js"></script>
    <script type="text/javascript" src="../js/waveform/states/select.js"></script>
    <script type="text/javascript" src="../js/waveform/states/shift.js"></script>
    <script type="text/javascript" src="../js/waveform/local_storage.js"></script>
    <script type="text/javascript" src="../js/waveform/config.js"></script>
    <script type="text/javascript" src="../js/waveform/track_render.js"></script>
    <script type="text/javascript" src="../js/waveform/fades.js"></script>
    <script type="text/javascript" src="../js/waveform/playout.js"></script>
    <script type="text/javascript" src="../js/waveform/track.js"></script>
    <script type="text/javascript" src="../js/waveform/time_scale.js"></script>
    <script type="text/javascript" src="../js/waveform/controls.js"></script>
    <script
  src="https://code.jquery.com/jquery-3.1.1.js"
  integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="
  crossorigin="anonymous"></script>

  </head>
  <body>
    <div id="playlist" class="playlist">
      <div id="top-bar" class="playlist-top-bar">
        <div class="playlist-toolbar">
          <div class="btn-group">
            <span title="restore playlist" class="btn-open btn btn-default"><i class="fa fa-folder-open"></i></span>
            <span title="save playlist" class="btn-save btn btn-default"><i class="fa fa-floppy-o"></i></span>
          </div>
          <div class="btn-group">
            <span class="btn-pause btn btn-default"><i class="fa fa-pause"></i></span>
            <span class="btn-play btn btn-default"><i class="fa fa-play"></i></span>
            <span class="btn-stop btn btn-default"><i class="fa fa-stop"></i></span>
            <span class="btn-rewind btn btn-default"><i class="fa fa-fast-backward"></i></span>
            <span class="btn-fast-forward btn btn-default"><i class="fa fa-fast-forward"></i></span>
          </div>
          <div class="btn-group">
            <span class="btn-state btn btn-default" data-state="cursor" title="select cursor"><i class="fa fa-headphones"></i></span>
            <span class="btn-state btn btn-default" data-state="select" title="select audio region"><i class="fa fa-italic"></i></span>
            <span class="btn-state btn btn-default" data-state="shift" title="shift audio in time"><i class="fa fa-arrows-h"></i></span>
            <span class="btn-state btn btn-default" data-state="fadein" title="set audio fade in"><i class="fa fa-long-arrow-left"></i></span>
            <span class="btn-state btn btn-default" data-state="fadeout" title="set audio fade out"><i class="fa fa-long-arrow-right"></i></span>
          </div>
          <!--<div class="btn-group">
            <span class="btn btn-default btn-fade" data-fade="logarithmic">logarithmic</span>
            <span class="btn btn-default btn-fade" data-fade="linear">linear</span>
            <span class="btn btn-default btn-fade" data-fade="exponential">exponential</span>
            <span class="btn btn-default btn-fade" data-fade="sCurve">s-curve</span>
          </div>-->
          <div id="btns_audio_tools" class="btn-group">
            <span title="keep only the selected audio region" class="btn-trim-audio btn btn-default disabled">Crop Audio Track</span>
          </div>
          <div class="btn-group">
            <span title="zoom in" class="btn-zoom-in btn btn-default"><i class="fa fa-search-plus"></i></span>
            <span title="zoom out" class="btn-zoom-out btn btn-default"><i class="fa fa-search-minus"></i></span>
          </div>
          <div class="btn-group">
            <span class="btn-corpse btn btn-danger" data-state="corpse" title="select audio region to send to the next user"><i class="fa fa-italic"></i></span>
          </div>
          <div class="btn-group">
            <span title="drag in a new track" class="btn-new-track btn btn-default"id class="fa fa-plus"></i> New Track</span>
            <span title="delete last track" class="btn-delete-track btn btn-default" id="delete"><i class="fa fa-times"></i> Last Trak</span>
          </div><br>
          <div class="btn-group">
              <span title="saveOrder" class="btn-saveOrder btn btn-default" id="saveOrder">saveOrder</span>
              <span title="CorpseCut" class="btn-CorpseCut btn btn-default" id="CorpseCut">Cut Corpse!</span>
              <span title="finish" class="btn-finish btn btn-default" id="finish">FINISH!</span>
          </div>

      </div>
      <div class="playlist-time-scale"></div>
      <div class="playlist-tracks"></div>
      <!--<div class="playlist-bottom-bar">
        <form class="form-inline">
          <select class="time-format form-control">
            <option value="seconds">seconds</option>
            <option value="thousandths">thousandths</option>
            <option value="hh:mm:ss">hh:mm:ss</option>
            <option value="hh:mm:ss.u">hh:mm:ss + tenths</option>
            <option value="hh:mm:ss.uu">hh:mm:ss + hundredths</option>
            <option value="hh:mm:ss.uuu">hh:mm:ss + milliseconds</option>
          </select>
          <input type="text" class="audio-start input-small form-control">
          <input type="text" class="audio-end input-small form-control">
          <label class="audio-pos">00:00:00.0</label>
        </form>
      </div>
    </div>
    <h3>Use the red cursor to cue where the next user can hear this track (keep it mysterious)</h3>
    <h3>NEXT USER EMAIL:</h3><textarea class="form-control">email@here.com</textarea>-->


    <script type="text/javascript">
    var corpseNum = 0;
    var corpseSet = 4;
    var timeStamp = 0;
    var globalLoss = 0;
    var isFinished = false;
    function punch(){
      var trackData = playlistEditor.getJson();
      $.post("/punch",
        {trackData:trackData},
        function(data,status){
            console.log(timeStamp);
        });
    }
    $('#saveOrder').click(punch);

    function test(){
      var trackData = playlistEditor.getInfo();
      console.log(trackData);
      for(var i in trackData){
        globalLoss += timeStamp;
        trackData[i].start -= timeStamp;
        trackData[i].end -= timeStamp;
      }
      trackData = JSON.stringify(trackData);
      $.post("/test",
        {trackData:trackData},
        function(data,status){
            console.log(timeStamp + "sent");
        });
    }
    $('#CorpseCut').click(test);
    function corpse (){
      
      isFinished = !isFinished;
      location.reload();
      console.log(isFinished);
    }
    $('#finish').click(corpse);

    function deleteTrack(){
      var trackData = playlistEditor.getInfo();
      console.log(trackData[0]);
      // $.post("/delete",
      //   {trackDelete:trackDelete},
      //   function(data,status){
      //       console.log(status);
      //   });
    }
    $('#delete').click(deleteTrack);


    (function(){

      $.get(
        "./tracks.json",
        function( res ) {
          $( ".result" ).html( res );
          var tracks = res;
          for(var i in res){
            corpseNum += 1;
            if(corpseNum < corpseSet){
              tracks = [res[i]];
            } else {
            tracks = res;
            }
          }

          var tracksLength = 0;
          function scaleRes(arr){
            for(var i in arr){
                tracksLength = parseInt(arr[i].end)+1;
            }
          }
          scaleRes(tracks);

          var config = new WaveformPlaylist.Config({
              resolution: tracksLength * 50,
              mono: true,
              waveHeight: 100,
              container: document.getElementById("playlist"),
              timescale: true,
              controls: {
                  show: true, //whether or not to include the track controls
                  width: 100, //width of controls in pixels
                  height:200 
              },
              UITheme: "bootstrap",
              state: 'select',
              waveOutlineColor: 'white'

          });  

          playlistEditor = Object.create(WaveformPlaylist, { //making this a global variable is cheating
            config: {
              value: config
            }
          });
          playlistEditor.init(tracks);
        },
        'json'
      );

    })();

    </script>
    <script>
    </script>
  </body>
</html>
