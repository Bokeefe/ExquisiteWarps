/*! waveform-playlist 0.3.1
Written by: Naomi Aro
Website: http://naomiaro.github.io/waveform-playlist
License: MIT */
"use strict";var WaveformPlaylist={init:function(a){var b,c,d,e,f,g=this.config.getContainer(),h=g.querySelector(".playlist-tracks"),i=document.createDocumentFragment();for(a=a||[],WaveformPlaylist.makePublisher(this),this.storage=Object.create(WaveformPlaylist.Storage),g.style.overflow="hidden",g.style.position="relative",this.trackContainer=h,this.trackContainer.style.overflow="auto",this.trackEditors=[],f=Object.create(WaveformPlaylist.AudioControls,{config:{value:this.config}}),f.init(),this.config.isTimeScaleEnabled()&&(this.timeScale=Object.create(WaveformPlaylist.TimeScale,{config:{value:this.config}}),this.timeScale.init(),f.on("changeresolution","onResolutionChange",this.timeScale),this.on("trackscroll","onTrackScroll",this.timeScale)),b=0,c=a.length;c>b;b++)d=Object.create(WaveformPlaylist.TrackEditor,{config:{value:this.config}}),e=d.loadTrack(a[b]),this.trackEditors.push(d),i.appendChild(e),d.on("trackloaded","onTrackLoad",this),d.on("changeshift","onChangeShift",this);this.trackContainer.appendChild(i),this.trackContainer.onscroll=this.onTrackScroll.bind(this),this.sampleRate=this.config.getSampleRate(),this.scrollTimeout=!1,this.animationRequest,this.animationCallback=this.updateEditor.bind(this),this.on("playbackcursor","onAudioUpdate",f),f.on("newtrack","createTrack",this),f.on("playlistsave","save",this),f.on("playlistrestore","restore",this),f.on("rewindaudio","rewind",this),f.on("fastforwardaudio","fastForward",this),f.on("playaudio","play",this),f.on("pauseaudio","pause",this),f.on("stopaudio","stop",this),f.on("trimaudio","onTrimAudio",this),f.on("changestate","onStateChange",this),f.on("changeselection","onSelectionChange",this),f.on("changevolume","onTrackVolumeChange",this),f.on("mutetrack","onMuteTrack",this),f.on("solotrack","onSoloTrack",this),this.audioControls=f,this.mutedTracks=[],this.soloedTracks=[],this.playoutPromises=[]},createTrack:function(){var a=Object.create(WaveformPlaylist.TrackEditor,{config:{value:this.config}}),b=a.init();a.setState("fileDrop"),this.trackEditors.push(a),this.trackContainer.appendChild(b),a.on("trackloaded","onTrackLoad",this)},removeTrack:function(a){var b,c,d,e=this.trackEditors;for(b=0,c=e.length;c>b;b++)if(d=e[b],d===a)return void e.splice(b,1)},onTrackLoad:function(a){this.audioControls.on("trackedit","onTrackEdit",a),this.audioControls.on("changeresolution","onResolutionChange",a),a.on("activateSelection","onAudioSelection",this.audioControls),a.on("deactivateSelection","onAudioDeselection",this.audioControls),a.on("changecursor","onCursorSelection",this.audioControls),a.on("changecursor","onSelectUpdate",this),void 0!==a.selectedArea&&this.activateTrack(a)},resize:function(){this.timeScale.onResize()},onTrimAudio:function(){this.activeTrack&&this.activeTrack.trim()},onSelectionChange:function(a){this.config.setCursorPos(a.start),this.activeTrack&&this.activeTrack.setSelectedArea(a.start,a.end)},setState:function(a){this.trackEditors.forEach(function(b){b.setState(a)},this)},onStateChange:function(){var a=this.config.getState();this.trackEditors.forEach(function(a){a.deactivate()},this),this.setState(a)},onTrackScroll:function(){var a=this;a.scrollTimeout||(a.scrollTimeout=setTimeout(function(){a.config.setTrackScroll(a.trackContainer.scrollLeft,a.trackContainer.scrollTop),a.fire("trackscroll",a.trackContainer.scrollLeft,a.trackContainer.scrollTop),a.scrollTimeout=!1},25))},onTrackVolumeChange:function(a){var b,c,d,e=this.trackEditors,f=a.gain,g=a.trackElement;for(b=0,c=e.length;c>b;b++)d=e[b],d.container===g&&d.setGainLevel(f)},adjustTrackPlayout:function(){var a;this.trackEditors.forEach(function(b){a=this.shouldTrackPlay(b)?1:0,b.setMasterGainLevel(a)},this)},onMuteTrack:function(a){var b,c,d,e,f=this.trackEditors;for(b=0,c=f.length;c>b;b++)d=f[b],d.container===a&&(e=this.mutedTracks.indexOf(d),e>-1?this.mutedTracks.splice(e,1):this.mutedTracks.push(d));this.adjustTrackPlayout()},onSoloTrack:function(a){var b,c,d,e,f=this.trackEditors;for(b=0,c=f.length;c>b;b++)d=f[b],d.container===a&&(e=this.soloedTracks.indexOf(d),e>-1?this.soloedTracks.splice(e,1):this.soloedTracks.push(d));this.adjustTrackPlayout()},activateTrack:function(a){this.trackEditors.forEach(function(b){b===a?(b.activate(),this.activeTrack=a):b.deactivate()},this)},onSelectUpdate:function(a){var b=a.editor;this.activateTrack(b),this.isPlaying()?(this.lastSeeked=a.start,this.pausedAt=void 0,this.restartPlayFrom(a.start)):(void 0!==this.pausedAt&&(this.pausedAt=void 0,this.trackEditors.forEach(function(a){a.showProgress(0)},this)),b.setSelectedArea(a.start,a.end,a.shiftKey))},onChangeShift:function(a){var b,c,d=this.trackEditors,e=0,f=0;for(b=0,c=d.length;c>b;b++)e=Math.max(e,d[b].drawer.containerWidth),f=Math.max(f,d[b].endTime);for(b=0,c=d.length;c>b;b++)d[b].drawer.updateContainerWidth(e);this.duration=f},rewind:function(){this.stop(),Promise.all(this.playoutPromises).then(function(){void 0!==this.activeTrack?(this.activeTrack.setSelectedArea(0,0,!1),this.activeTrack.notifySelectUpdate(0,0)):this.config.setCursorPos(0),this.trackContainer.scrollLeft=0,this.config.setTrackScroll(0),this.fire("trackscroll")}.bind(this))},fastForward:function(){var a=this.trackContainer.scrollWidth,b=this.trackContainer.offsetWidth,c=Math.max(a-b,0);this.stop(),Promise.all(this.playoutPromises).then(function(){void 0!==this.activeTrack?(this.activeTrack.setSelectedArea(this.duration,this.duration,!1),this.activeTrack.notifySelectUpdate(this.duration,this.duration)):this.config.setCursorPos(this.duration),this.trackContainer.scrollLeft=c,this.config.setTrackScroll(c),this.fire("trackscroll")}.bind(this))},getSelected:function(){return this.activeTrack?this.activeTrack.selectedArea:void 0},isPlaying:function(){var a,b,c=this.trackEditors,d=!1;for(a=0,b=c.length;b>a;a++)d=d||c[a].isPlaying();return d},shouldTrackPlay:function(a){var b;return this.soloedTracks.length>0?(b=!1,this.soloedTracks.indexOf(a)>-1&&(b=!0)):(b=!0,this.mutedTracks.indexOf(a)>-1&&(b=!1)),b},restartPlayFrom:function(a){this.stopAnimation(),this.trackEditors.forEach(function(a){a.scheduleStop()},this),Promise.all(this.playoutPromises).then(this.play.bind(this,a))},getCurrentTime:function(){var a=this.lastSeeked||this.pausedAt||this.config.getCursorPos();return a+this.getElapsedTime()},getElapsedTime:function(){var a=this.config.getCurrentTime();return a-this.lastPlay},play:function(a){var b,c=this.config.getCurrentTime(),d=this.getSelected(),e=[];a=a||this.pausedAt||this.config.getCursorPos(),void 0!==d&&d.endTime>a&&(b=d.endTime),this.setState("cursor"),this.trackEditors.forEach(function(d){e.push(d.schedulePlay(c,a,b,{masterGain:this.shouldTrackPlay(d)?1:0}))},this),this.lastPlay=c,this.playoutPromises=e,this.startAnimation(a)},pause:function(){this.isPlaying()&&(this.pausedAt=this.getCurrentTime(),this.lastSeeked=void 0,this.stopAnimation(),this.trackEditors.forEach(function(a){a.scheduleStop()},this),this.setState(this.config.getState()))},stop:function(){this.pausedAt=void 0,this.lastSeeked=void 0,this.stopAnimation(),this.trackEditors.forEach(function(a){a.scheduleStop(),a.showProgress(0)},this),this.setState(this.config.getState())},updateEditor:function(a){var b,c=this.config.getCurrentTime(),d=a;a=a||this.config.getCursorPos(),b=c-this.lastDraw,this.isPlaying()?(b&&(d=a+b,this.trackEditors.forEach(function(a){a.showProgress(d)},this),this.fire("playbackcursor",{seconds:d})),this.animationRequest=window.requestAnimationFrame(this.animationCallback.bind(this,d))):(this.stopAnimation(),this.trackEditors.forEach(function(a){a.showProgress(0)},this),this.pausedAt=void 0,this.lastSeeked=void 0),this.lastDraw=c},startAnimation:function(a){this.lastDraw=this.config.getCurrentTime(),this.animationRequest=window.requestAnimationFrame(this.animationCallback.bind(this,a))},stopAnimation:function(){window.cancelAnimationFrame(this.animationRequest),this.lastDraw=void 0},getInfo:function(){var a=[];return this.trackEditors.forEach(function(b){a.push(b.getTrackDetails())},this),a},getJson:function(){return JSON.stringify(this.getInfo())},save:function(){this.storage.save("test",this.getInfo())},restore:function(){var a=this.storage.restore("test");this.destroy(),this.init(a)},destroy:function(){this.trackEditors.forEach(function(a){a.destroy()},this),this.trackContainer.innerHTML=""}};WaveformPlaylist.unitConversions={samplesToSeconds:function(a){return a/this.sampleRate},secondsToSamples:function(a){return Math.ceil(a*this.sampleRate)},samplesToPixels:function(a){return~~(a/this.resolution)},pixelsToSamples:function(a){return~~(a*this.resolution)},pixelsToSeconds:function(a){return a*this.resolution/this.sampleRate},secondsToPixels:function(a){return~~(a*this.sampleRate/this.resolution)}},WaveformPlaylist.curves={createLinearBuffer:function(a,b){var c,d,e=new Float32Array(a),f=a-1;for(c=0;a>c;c++)d=c/f,b>0?e[c]=d:e[c]=1-d;return e},createExponentialBuffer:function(a,b){var c,d,e,f=new Float32Array(a),g=a-1;for(c=0;a>c;c++)d=c/g,e=b>0?c:a-1-c,f[e]=Math.exp(2*d-1)/Math.exp(1);return f},createSCurveBuffer:function(a,b){var c,d=new Float32Array(a);for(c=0;a>c;++c)d[c]=Math.sin(Math.PI*c/a-b)/2+.5;return d},createLogarithmicBuffer:function(a,b,c){var d,e,f=new Float32Array(a),g=""+a+b+c,h=[],i=0;if(h[g])return h[g];for(e=0;a>e;e++)d=c>0?e:a-1-e,i=e/a,f[d]=Math.log(1+b*i)/Math.log(1+b);return h[g]=f,f}},WaveformPlaylist.mixin=function(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]})},WaveformPlaylist.publisher={subscribers:{any:[]},on:function(a,b,c){a=a||"any",b="function"==typeof b?b:c[b],"undefined"==typeof this.subscribers[a]&&(this.subscribers[a]=[]),this.subscribers[a].push({fn:b,context:c||this})},remove:function(a,b,c){this.visitSubscribers("unsubscribe",a,b,c)},fire:function(a,b){this.visitSubscribers("publish",a,b)},reset:function(){this.subscribers={any:[]}},visitSubscribers:function(a,b,c,d){var e,f=b||"any",g=this.subscribers[f],h=g?g.length:0;for(e=0;h>e;e+=1)"publish"===a?g[e].fn.call(g[e].context,c):g[e].fn===c&&g[e].context===d&&g.splice(e,1)}},WaveformPlaylist.makePublisher=function(a){var b,c=WaveformPlaylist.publisher;for(b in c)c.hasOwnProperty(b)&&"function"==typeof c[b]&&(a[b]=c[b]);a.subscribers={any:[]}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.cursor={classes:"state-cursor",enter:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=a.event.bind(this),this.container.classList.add(a.classes)},leave:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=null,this.container.classList.remove(a.classes)},event:function(a){a.preventDefault();var b,c;b=this.drawer.findClickedPixel(a),c=this.pixelsToSeconds(b),this.notifySelectUpdate(c,c)}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.fadein={classes:"state-fadein",enter:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=a.event.bind(this),this.container.classList.add(a.classes)},leave:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=null,this.container.classList.remove(a.classes)},event:function(a){var b=this.drawer.findClickedPixel(a),c="FadeIn",d=this.config.getFadeType(),e=this.drawer.pixelOffset,f=e+this.drawer.width;this.removeFadeType(c),b>=e&&f>=b&&this.createFade(c,d,0,b-e)}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.fadeout={classes:"state-fadeout",enter:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=a.event.bind(this),this.container.classList.add(a.classes)},leave:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=null,this.container.classList.remove(a.classes)},event:function(a){var b=this.drawer.findClickedPixel(a),c="FadeOut",d=this.config.getFadeType(),e=this.drawer.pixelOffset,f=e+this.drawer.width;this.removeFadeType(c),b>=e&&f>=b&&this.createFade(c,d,b-e,this.drawer.width)}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.fileDrop={classes:{container:"state-file-drop",drag:"drag-enter"},enter:function(){var a=this.currentState;this.container.classList.add(a.classes.container),this.container.ondragenter=a.dragenter.bind(this),this.container.ondragover=a.dragover.bind(this),this.container.ondragleave=a.dragleave.bind(this),this.container.ondrop=a.drop.bind(this)},leave:function(){var a=this.currentState;this.container.ondragenter=null,this.container.ondragover=null,this.container.ondragleave=null,this.container.ondrop=null,this.container.classList.remove(a.classes.container)},dragenter:function(){var a=this.currentState;this.container.classList.add(a.classes.drag)},dragover:function(a){a.stopPropagation(),a.preventDefault()},dragleave:function(){var a=this.currentState;this.container.classList.remove(a.classes.drag)},drop:function(a){a.stopPropagation(),a.preventDefault();var b=this.currentState;this.container.classList.remove(b.classes.drag),a.dataTransfer.files.length&&this.loadBlob(a.dataTransfer.files[0])}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.select={classes:"state-select",enter:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=a.event.bind(this),this.container.classList.add(a.classes)},leave:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=null,this.container.classList.remove(a.classes)},event:function(a){a.preventDefault();var b,c,d,e=this.drawer.waveformContainer,f=this;b=f.drawer.findClickedPixel(a),c=f.pixelsToSeconds(b),e.onmousemove=function(a){a.preventDefault();var c,d,e=f.drawer.findClickedPixel(a),g=Math.min(e,b),h=Math.max(e,b);c=f.pixelsToSeconds(g),d=f.pixelsToSeconds(h),f.notifySelectUpdate(c,d)},d=function(a){a.preventDefault();var c,d,g,h,i=f.drawer.findClickedPixel(a);c=Math.min(b,i),d=Math.max(b,i),g=f.pixelsToSeconds(c),h=f.pixelsToSeconds(d),f.notifySelectUpdate(g,h,a.shiftKey),e.onmousemove=e.onmouseup=e.onmouseleave=null},e.onmouseup=e.onmouseleave=d}},WaveformPlaylist.states=WaveformPlaylist.states||{},WaveformPlaylist.states.shift={classes:"state-shift",enter:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=a.event.bind(this),this.container.classList.add(a.classes)},leave:function(){var a=this.currentState;this.drawer.waveformContainer.onmousedown=null,this.container.classList.remove(a.classes)},event:function(a){a.preventDefault();var b,c=this.drawer.waveformContainer,d=this,e=a.pageX,f=0,g=0,h=d.leftOffset/d.resolution;c.onmousemove=function(a){a.preventDefault();var b=a.pageX;f=b-e,g=h+f,d.setLeftOffset(d.pixelsToSamples(g))},b=function(a){a.preventDefault();var b=d.pixelsToSeconds(f);c.onmousemove=c.onmouseup=c.onmouseleave=null,d.startTime=d.startTime+b,d.endTime=d.endTime+b,d.setLeftOffset(d.pixelsToSamples(g))},c.onmouseup=c.onmouseleave=b}},WaveformPlaylist.Config=function(a){var b,c=this;b={ac:new(window.AudioContext||window.webkitAudioContext),resolution:4096,minResolution:500,maxResolution:2e4,timeFormat:"hh:mm:ss.uu",mono:!0,fadeType:"logarithmic",timescale:!1,controls:{show:!1,width:150},UITheme:"default",waveOutlineColor:"white",timeColor:"grey",fadeColor:"black",waveHeight:128,trackscroll:{left:0,top:0},state:"select",cursorPos:0},a=Object.create(a),Object.keys(b).forEach(function(c){c in a||(a[c]=b[c])}),c.getContainer=function(){return a.container},c.isTimeScaleEnabled=function(){return a.timescale},c.getFadeType=function(){return a.fadeType},c.isDisplayMono=function(){return a.mono},c.getUITheme=function(){return a.UITheme},c.getCursorPos=function(){return a.cursorPos},c.getState=function(){return a.state},c.getAudioContext=function(){return a.ac},c.getSampleRate=function(){return a.ac.sampleRate},c.getCurrentTime=function(){return a.ac.currentTime},c.getTimeFormat=function(){return a.timeFormat},c.getMinResolution=function(){return a.minResolution},c.getMaxResolution=function(){return a.maxResolution},c.getResolution=function(){return a.resolution},c.getWaveHeight=function(){return a.waveHeight},c.getColorScheme=function(){return{waveOutlineColor:a.waveOutlineColor,timeColor:a.timeColor,fadeColor:a.fadeColor,selectBorderColor:a.selectBorderColor,selectBackgroundColor:a.selectBackgroundColor}},c.getControlSettings=function(){return{show:a.controls.show,width:a.controls.width}},c.getTrackScroll=function(){var b=a.trackscroll;return{left:b.left,top:b.top}},c.setResolution=function(b){a.resolution=b},c.setTimeFormat=function(b){a.timeFormat=b},c.setFadeType=function(b){a.fadeType=b},c.setDisplayMono=function(b){a.mono=b},c.setCursorPos=function(b){a.cursorPos=b},c.setState=function(b){a.state=b},c.setTrackScroll=function(b,c){var d=a.trackscroll;d.left=void 0!==b?b:d.left,d.top=void 0!==c?c:d.top}},WaveformPlaylist.AudioControls={groups:{"audio-select":["btns_audio_tools"]},classes:{disabled:"disabled",active:"active"},eventTypes:{onclick:{"btn-rewind":"rewindAudio","btn-fast-forward":"fastForwardAudio","btn-play":"playAudio","btn-pause":"pauseAudio","btn-stop":"stopAudio","btn-state":"changeState","btn-save":"save","btn-open":"open","btn-trim-audio":"trimAudio","btn-fade":"changeDefaultFade","btn-zoom-in":"zoomIn","btn-zoom-out":"zoomOut","btn-new-track":"newTrack","btn-mute":"muteTrack","btn-solo":"soloTrack"},onchange:{"time-format":"changeTimeFormat"},oninput:{"volume-slider":"changeVolume"}},init:function(){var a,b,c,d;WaveformPlaylist.makePublisher(this),b=this.config.getContainer(),a=this.config.getState(),c=this.config.getFadeType(),this.ctrls={},this.ctrls["time-format"]=b.querySelector(".time-format"),this.ctrls["audio-start"]=b.querySelector(".audio-start"),this.ctrls["audio-end"]=b.querySelector(".audio-end"),this.ctrls["audio-pos"]=b.querySelector(".audio-pos"),[".btn-state[data-state='"+a+"']",".btn-fade[data-fade='"+c+"']"].forEach(function(a){d=b.querySelector(a),d&&this.activateButton(d)},this),Object.keys(this.eventTypes).forEach(function(a){var c=this;!function(a,d){b[a]=function(b){var e,f=c.nodeChainContainsClassName(b.currentTarget,b.target,d);f&&(e=f.className)&&c[c.eventTypes[a][e]].call(c,b)}}(a,Object.keys(this.eventTypes[a]))},this),this.ctrls["time-format"]&&(this.ctrls["time-format"].value=this.config.getTimeFormat()),this.ctrls["time-format"]&&(this.ctrls["audio-start"].onblur=this.validateCueIn.bind(this)),this.ctrls["time-format"]&&(this.ctrls["audio-end"].onblur=this.validateCueOut.bind(this)),this.timeFormat=this.config.getTimeFormat(),this.currentSelectionValues=void 0,this.onCursorSelection({start:0,end:0})},nodeChainContainsClassName:function(a,b,c){var d,e,f,g;for(g=b;g;){for(d=0,e=c.length;e>d;d++)if(f=c[d],g.classList.contains(f))return{className:f,node:g};if(g===a)break;g=g.parentElement}},validateCue:function(a){var b,c,d;return b={seconds:/^\d+$/,thousandths:/^\d+\.\d{3}$/,"hh:mm:ss":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]$/,"hh:mm:ss.u":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{1}$/,"hh:mm:ss.uu":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{2}$/,"hh:mm:ss.uuu":/^[0-9]{2,}:[0-5][0-9]:[0-5][0-9]\.\d{3}$/},c=b[this.timeFormat],d=c.test(a)},cueToSeconds:function(a){function b(a){var b,c=a.split(":"),d=3600*parseInt(c[0],10),e=60*parseInt(c[1],10),f=parseFloat(c[2]);return b=d+e+f}var c,d,e;return c={seconds:function(a){return parseInt(a,10)},thousandths:function(a){return parseFloat(a)},"hh:mm:ss":function(a){return b(a)},"hh:mm:ss.u":function(a){return b(a)},"hh:mm:ss.uu":function(a){return b(a)},"hh:mm:ss.uuu":function(a){return b(a)}},d=c[this.timeFormat],e=d(a)},cueFormatters:function(a){function b(a,b){var c,d,e,f;return c=parseInt(a/3600,10)%24,d=parseInt(a/60,10)%60,e=a%60,e=e.toFixed(b),f=(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)+":"+(10>e?"0"+e:e)}var c={seconds:function(a){return a.toFixed(0)},thousandths:function(a){return a.toFixed(3)},"hh:mm:ss":function(a){return b(a,0)},"hh:mm:ss.u":function(a){return b(a,1)},"hh:mm:ss.uu":function(a){return b(a,2)},"hh:mm:ss.uuu":function(a){return b(a,3)}};return c[a]},changeTimeFormat:function(a){var b,c,d,e=a.target.value;e=void 0!==this.cueFormatters(e)?e:"hh:mm:ss",this.config.setTimeFormat(e),this.timeFormat=e,void 0!==this.currentSelectionValues&&(b=this.cueFormatters(e),c=this.currentSelectionValues.start,d=this.currentSelectionValues.end,this.ctrls["audio-start"]&&(this.ctrls["audio-start"].value=b(c)),this.ctrls["audio-end"]&&(this.ctrls["audio-end"].value=b(d)))},zoomIn:function(){var a=.75*this.config.getResolution(),b=this.config.getMinResolution();a=b>a?b:a,a>b&&this.zoom(a)},zoomOut:function(){var a=this.config.getResolution()*(4/3),b=this.config.getMaxResolution();a=a>b?b:a,b>a&&this.zoom(a)},zoom:function(a){this.config.setResolution(a),this.fire("changeresolution",a)},newTrack:function(){this.fire("newtrack")},validateCueIn:function(a){var b,c,d=a.target.value;return this.validateCue(d)&&(b=this.currentSelectionValues.end,c=this.cueToSeconds(d),b>=c)?(this.notifySelectionUpdate(c,b),void(this.currentSelectionValues.start=c)):void(a.target.value=this.cueFormatters(this.timeFormat)(this.currentSelectionValues.start))},validateCueOut:function(a){var b,c,d=a.target.value;return this.validateCue(d)&&(b=this.currentSelectionValues.start,c=this.cueToSeconds(d),c>=b)?(this.notifySelectionUpdate(b,c),void(this.currentSelectionValues.end=c)):void(a.target.value=this.cueFormatters(this.timeFormat)(this.currentSelectionValues.end))},activateButtonGroup:function(a){var b,c,d,e=document.getElementById(a),f=this.classes;if(null!==e)for(b=e.children,c=0,d=b.length;d>c;c++)b[c].classList.remove(f.disabled)},deactivateButtonGroup:function(a){var b,c,d,e=document.getElementById(a),f=this.classes;if(null!==e)for(b=e.children,c=0,d=b.length;d>c;c++)b[c].classList.add(f.disabled)},activateAudioSelection:function(){var a,b,c=this.groups["audio-select"];for(a=0,b=c.length;b>a;a++)this.activateButtonGroup(c[a])},deactivateAudioSelection:function(){var a,b,c=this.groups["audio-select"];for(a=0,b=c.length;b>a;a++)this.deactivateButtonGroup(c[a])},save:function(){this.fire("playlistsave")},open:function(){this.fire("playlistrestore")},rewindAudio:function(){this.fire("rewindaudio")},fastForwardAudio:function(){this.fire("fastforwardaudio")},playAudio:function(){this.fire("playaudio")},pauseAudio:function(){this.fire("pauseaudio")},stopAudio:function(){this.fire("stopaudio")},changeVolume:function(a){var b=(this.config.getContainer(),this.nodeChainContainsClassName(a.currentTarget,a.target,["channel-wrapper"]).node);this.fire("changevolume",{trackElement:b,gain:a.target.value/100})},muteTrack:function(a){var b=this.nodeChainContainsClassName(a.currentTarget,a.target,["btn-mute"]).node,c=this.nodeChainContainsClassName(a.currentTarget,b,["channel-wrapper"]).node;b.classList.toggle(this.classes.active),this.fire("mutetrack",c)},soloTrack:function(a){var b=this.nodeChainContainsClassName(a.currentTarget,a.target,["btn-solo"]).node,c=this.nodeChainContainsClassName(a.currentTarget,b,["channel-wrapper"]).node;b.classList.toggle(this.classes.active),this.fire("solotrack",c)},activateButton:function(a){a&&a.classList.add(this.classes.active)},deactivateButton:function(a){a&&a.classList.remove(this.classes.active)},enableButton:function(a){a&&a.classList.remove(this.classes.disabled)},disableButton:function(a){a&&a.classList.add(this.classes.disabled)},changeState:function(a){var b=this.nodeChainContainsClassName(a.currentTarget,a.target,["btn-state"]),c=b.node,d=c.parentElement.querySelector(".active"),e=c.dataset.state;this.deactivateButton(d),this.activateButton(c),this.config.setState(e),this.fire("changestate")},changeDefaultFade:function(a){var b=this.nodeChainContainsClassName(a.currentTarget,a.target,["btn-fade"]),c=b.node,d=c.parentElement.querySelector(".active"),e=c.dataset.fade;this.deactivateButton(d),this.activateButton(c),this.config.setFadeType(e)},trimAudio:function(a){var b,c=a.target,d=this.classes;b=c.classList.contains(d.disabled),b||this.fire("trackedit",{type:"trimAudio"})},createFade:function(a){var b,c=a.target,d=c.dataset.shape,e=c.dataset.type,f=this.classes;b=c.classList.contains(f.disabled),b||this.fire("trackedit",{type:"createFade",args:{type:e,shape:d}})},onAudioSelection:function(){this.activateAudioSelection()},onAudioDeselection:function(){this.deactivateAudioSelection()},notifySelectionUpdate:function(a,b){this.fire("changeselection",{start:a,end:b})},onCursorSelection:function(a){var b=this.cueFormatters(this.timeFormat)(a.start),c=this.cueFormatters(this.timeFormat)(a.end),d=this.cueToSeconds(b),e=this.cueToSeconds(c);this.currentSelectionValues={start:d,end:e},this.ctrls["audio-start"]&&(this.ctrls["audio-start"].value=b),this.ctrls["audio-end"]&&(this.ctrls["audio-end"].value=c)},onAudioUpdate:function(a){this.ctrls["audio-pos"]&&(this.ctrls["audio-pos"].innerHTML=this.cueFormatters(this.timeFormat)(a.seconds))}},WaveformPlaylist.fades={sCurveFadeIn:function(a,b,c,d){var e;e=this.createSCurveBuffer(this.sampleRate,Math.PI/2),a.setValueCurveAtTime(e,b,c)},sCurveFadeOut:function(a,b,c,d){var e;e=this.createSCurveBuffer(this.sampleRate,-(Math.PI/2)),a.setValueCurveAtTime(e,b,c)},linearFadeIn:function(a,b,c,d){a.linearRampToValueAtTime(0,b),a.linearRampToValueAtTime(1,b+c)},linearFadeOut:function(a,b,c,d){a.linearRampToValueAtTime(1,b),a.linearRampToValueAtTime(0,b+c)},exponentialFadeIn:function(a,b,c,d){a.exponentialRampToValueAtTime(.01,b),a.exponentialRampToValueAtTime(1,b+c)},exponentialFadeOut:function(a,b,c,d){a.exponentialRampToValueAtTime(1,b),a.exponentialRampToValueAtTime(.01,b+c)},logarithmicFadeIn:function(a,b,c,d){var e,f=d.base;f="undefined"!=typeof f?f:10,e=this.createLogarithmicBuffer(this.sampleRate,f,1),a.setValueCurveAtTime(e,b,c)},logarithmicFadeOut:function(a,b,c,d){var e,f=d.base;f="undefined"!=typeof f?f:10,e=this.createLogarithmicBuffer(this.sampleRate,f,-1),a.setValueCurveAtTime(e,b,c)},createFadeIn:function(a,b,c){var d=b+"FadeIn",e=this[d];e.call(this,a,c.start,c.duration,c)},createFadeOut:function(a,b,c){var d=b+"FadeOut",e=this[d];e.call(this,a,c.start,c.duration,c)}},WaveformPlaylist.mixin(WaveformPlaylist.fades,WaveformPlaylist.curves),WaveformPlaylist.Storage={save:function(a,b){var c=JSON.stringify(b);localStorage.setItem(a,c)},restore:function(a){var b,c=localStorage.getItem(a);return b=JSON.parse(c)}},WaveformPlaylist.AudioPlayout={init:function(){this.ac=this.config.getAudioContext(),this.fadeMaker=Object.create(WaveformPlaylist.fades,{sampleRate:{value:this.ac.sampleRate}}),this.gain=1,this.destination=this.ac.destination},getBuffer:function(){return this.buffer},applyFades:function(a,b,c){var d,e,f,g,h,i;for(d in a)e=a[d],b>=e.end||(b<=e.start?(h=c+(e.start-b),i=e.end-e.start):b>e.start&&b<e.end&&(h=c-(b-e.start),i=e.end-e.start),g={start:h,duration:i},a.hasOwnProperty(d)&&(f=this.fadeMaker["create"+e.type],f.call(this.fadeMaker,this.fadeGain.gain,e.shape,g)))},loadData:function(a,b){var c=this;this.ac.decodeAudioData(a,function(a){c.buffer=a,b(a)},function(a){console.log("err(decodeAudioData): "+a),b(null,a)})},isPlaying:function(){return void 0!==this.source},getDuration:function(){return this.buffer.duration},setUpSource:function(){var a,b=this;return this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer,a=new Promise(function(a,c){b.source.onended=function(c){b.source.disconnect(),b.fadeGain.disconnect(),b.outputGain.disconnect(),b.masterGain.disconnect(),b.source=void 0,b.fadeGain=void 0,b.outputGain=void 0,b.masterGain=void 0,a()}}),this.fadeGain=this.ac.createGain(),this.outputGain=this.ac.createGain(),this.masterGain=this.ac.createGain(),this.source.connect(this.fadeGain),this.fadeGain.connect(this.outputGain),this.outputGain.connect(this.masterGain),this.masterGain.connect(this.destination),a},setGainLevel:function(a){this.outputGain&&(this.outputGain.gain.value=a)},setMasterGainLevel:function(a){this.masterGain&&(this.masterGain.gain.value=a)},play:function(a,b,c){this.source.start(a||0,b,c)},stop:function(a){this.source&&this.source.stop(a||0)}},WaveformPlaylist.TimeScale={init:function(){function a(){f.width=f.container.clientWidth,f.height=f.container.clientHeight,c.setAttribute("width",f.width),c.setAttribute("height",f.height),f.drawScale()}function b(){clearTimeout(e),e=setTimeout(a,100)}var c,d,e,f=this,g=this.config.getControlSettings();this.timeinfo={2e4:{marker:3e4,bigStep:1e4,smallStep:5e3,secondStep:5},12e3:{marker:15e3,bigStep:5e3,smallStep:1e3,secondStep:1},1e4:{marker:1e4,bigStep:5e3,smallStep:1e3,secondStep:1},5e3:{marker:5e3,bigStep:1e3,smallStep:500,secondStep:.5},2500:{marker:2e3,bigStep:1e3,smallStep:500,secondStep:.5},1500:{marker:2e3,bigStep:1e3,smallStep:200,secondStep:.2},700:{marker:1e3,bigStep:500,smallStep:100,secondStep:.1}},WaveformPlaylist.makePublisher(this),d=document.querySelector(".playlist-time-scale"),d.style.position="relative",d.style.left=0,d.style.right=0,g.show&&(d.style.marginLeft=g.width+"px"),void 0!==d&&(c=document.createElement("canvas"),this.canv=c,this.context=c.getContext("2d"),this.container=d,this.width=this.container.clientWidth,this.height=this.container.clientHeight,c.setAttribute("width",this.width),c.setAttribute("height",this.height),c.style.position="absolute",c.style.left=0,c.style.right=0,c.style.top=0,c.style.bottom=0,this.times=[],this.prevScrollPos=0,this.onResize=b,this.drawScale())},getScaleInfo:function(a){var b,c,d;for(b=Object.keys(this.timeinfo).map(function(a){return parseInt(a,10)}),b=b.sort(function(a,b){return a-b}),c=0,d=b.length;d>c;c++)if(a<=b[c])return this.timeinfo[b[c]]},formatTime:function(a){var b,c,d,e;return e=a/1e3,d=e%60,c=(e-d)/60,10>d&&(d="0"+d),b=c+":"+d},clear:function(){this.container.innerHTML="",this.context.clearRect(0,0,this.width,this.height)},drawScale:function(a){var b,c,d,e,f,g,h,i,j,k=this.context,l=this.config.getColorScheme(),m=this.config.getResolution(),n=this.config.getSampleRate(),o=n/m,p=a||0,q=0,r=document.createDocumentFragment(),s=this.getScaleInfo(m);for(this.clear(),r.appendChild(this.canv),k.fillStyle=l.timeColor,d=this.width+p,c=0;d>c;c+=o*s.secondStep)e=~~c,b=e-p,e>=p&&(s.marker&&q%s.marker===0?(h=this.formatTime(q),g=document.createTextNode(h),f=document.createElement("div"),f.style.position="absolute",f.style.left=b+"px",f.appendChild(g),r.appendChild(f),j=10):s.bigStep&&q%s.bigStep===0?j=5:s.smallStep&&q%s.smallStep===0&&(j=2),i=this.height-j,k.fillRect(b,i,1,j)),q+=1e3*s.secondStep;this.container.appendChild(r)},onTrackScroll:function(a,b){a!==this.prevScrollPos&&(this.prevScrollPos=a,this.drawScale(a))},onResolutionChange:function(){var a=this.config.getTrackScroll(),b=a.left;this.drawScale(b)}},WaveformPlaylist.TrackEditor={init:function(a,b,c,d,e,f){var g={cursor:!0,fadein:!0,fadeout:!0,select:!0,shift:!0,fileDrop:!0};if(f=f||{},Object.keys(g).forEach(function(a){g[a]=a in f?f[a]:g[a]}),this.enabledStates=g,WaveformPlaylist.makePublisher(this),this.playout=Object.create(WaveformPlaylist.AudioPlayout,{config:{value:this.config}}),this.playout.init(),this.sampleRate=this.config.getSampleRate(),this.resolution=this.config.getResolution(),this.startTime=b||0,this.endTime=c||0,this.fades={},void 0!==d&&d.length>0)for(var h=0;h<d.length;h++)this.fades[this.getFadeId()]=d[h];return void 0!==e&&(this.cuein=e.cuein,this.cueout=e.cueout),this.active=!1,this.gain=1,this.selectedArea=void 0,this.drawer=Object.create(WaveformPlaylist.WaveformDrawer,{config:{value:this.config}}),this.container=this.drawer.init(),this.container},setLeftOffset:function(a){this.leftOffset=a,this.drawer.setPixelOffset(a/this.resolution),this.fire("changeshift")},getFadeId:function(){var a=""+Math.random();return a.replace(".","")},getBuffer:function(){return this.playout.getBuffer()},loadTrack:function(a){var b;return b=this.init(a.src,a.start,a.end,a.fades,{cuein:a.cuein,cueout:a.cueout},a.states),void 0!==a.selected&&(this.selectedArea={startTime:a.selected.start,endTime:a.selected.end}),this.drawer.drawLoading(),this.loadBuffer(a.src),b},fileProgress:function(a){var b;a.lengthComputable&&(b=a.loaded/a.total*100,this.drawer.updateLoader(b))},fileLoad:function(a){
var b=this;this.drawer.setLoaderState("decoding"),this.playout.loadData(a.target.response||a.target.result,b.onTrackLoad.bind(b))},loadBuffer:function(a){var b=new XMLHttpRequest;this.filename=a.replace(/^.*[\\\/]/,""),this.src=a,b.open("GET",a,!0),b.responseType="arraybuffer",b.addEventListener("progress",this.fileProgress.bind(this)),b.addEventListener("load",this.fileLoad.bind(this)),b.send()},loadBlob:function(a){if(a.type.match(/audio.*/)){var b=new FileReader,c=new FileReader,d=this;this.filename=a.name,this.drawer.drawLoading(),b.addEventListener("load",function(){d.src=b.result}),c.addEventListener("progress",this.fileProgress.bind(this)),c.addEventListener("load",this.fileLoad.bind(this)),c.addEventListener("error",function(){console.error("error loading file "+this.filename)}),b.readAsDataURL(a),c.readAsArrayBuffer(a)}},drawTrack:function(a){this.drawer.drawWaveform(a,this.cues,this.fades)},onTrackLoad:function(a,b){var c,d,e,f;return void 0!==b?(this.drawer.drawError(),void this.fire("error",this)):(this.fire("trackloaded",this),e=this.cuein&&this.secondsToSamples(this.cuein)||0,f=this.cueout&&this.secondsToSamples(this.cueout)||a.length,this.setCuePoints(e,f),this.drawer.drawContainer(a,this.cues,this.fades,this.filename),this.setLeftOffset(this.secondsToSamples(this.startTime)),this.setState(this.config.getState()),void(void 0!==this.selectedArea&&(c=this.selectedArea.startTime,d=this.selectedArea.endTime,this.showSelection(),this.notifySelectUpdate(c,d))))},activate:function(){this.active=!0,this.drawer.drawActive()},deactivate:function(){this.active=!1,this.drawer.drawInactive(),this.selectedArea&&(this.selectedArea=void 0)},notifySelectUpdate:function(a,b,c){this.fire("changecursor",{start:a,end:b,shiftKey:c,editor:this})},setSelectedArea:function(a,b,c){c&&a===b&&void 0!==this.prevSelectedArea&&(a>=this.prevSelectedArea.endTime?a=this.prevSelectedArea.startTime:a<=this.prevSelectedArea.startTime&&(b=this.prevSelectedArea.endTime)),this.prevSelectedArea=this.selectedArea,this.selectedArea={startTime:a,endTime:b},this.config.setCursorPos(a),this.showSelection(),b>a?this.activateAudioSelection():this.deactivateAudioSelection()},activateAudioSelection:function(){this.fire("activateSelection")},deactivateAudioSelection:function(){this.fire("deactivateSelection")},saveFade:function(a,b,c,d,e){return this.fades[a]={type:b,shape:c,start:d,end:e},a},removeFade:function(a){delete this.fades[a],this.drawer.removeFade(a)},removeFadeType:function(a){var b,c,d=this.fades;for(b in d)c=d[b],c.type===a&&this.removeFade(b)},setCuePoints:function(a,b){var c=this.cues?this.cues.cuein:0,d=this.getBuffer(),e=this.cues?this.cues.cueout:d.length;0>a&&(a=0),c+b>e&&(b=e-c),this.cues={cuein:c+a,cueout:c+b},this.duration=(b-a)/this.sampleRate,this.endTime=this.duration+this.startTime,this.cuein=this.samplesToSeconds(this.cues.cuein),this.cueout=this.samplesToSeconds(this.cues.cueout)},trim:function(){var a,b,c=this.selectedArea;void 0!==c&&(a=this.secondsToSamples(c.startTime)-this.leftOffset,b=this.secondsToSamples(c.endTime)-this.leftOffset+1,this.setCuePoints(a,b),this.notifySelectUpdate(0,0),this.fades={},this.drawTrack(this.getBuffer()))},onTrackEdit:function(a){var b=a.type,c="on"+b.charAt(0).toUpperCase()+b.slice(1);this.active===!0&&this[c].call(this,a.args)},createFade:function(a,b,c,d){var e=(this.selectedArea,this.pixelsToSeconds(c)),f=this.pixelsToSeconds(d),g=this.getFadeId();this.notifySelectUpdate(0,0),this.saveFade(g,a,b,e,f),this.drawer.drawFade(g,a,b,c,d)},onCreateFade:function(a){this.createFade(a.type,a.shape),this.deactivateAudioSelection()},onTrimAudio:function(){var a=this.selectedArea;this.trim(a.start,a.end),this.deactivateAudioSelection()},setState:function(a){this.currentState&&this.currentState.leave.call(this),this.enabledStates[a]&&(this.currentState=WaveformPlaylist.states[a],this.currentState.enter.call(this))},onResolutionChange:function(a){var b=this.selectedArea;this.resolution=a,this.drawTrack(this.getBuffer()),this.drawer.setPixelOffset(this.leftOffset/a),this.active===!0&&void 0!==this.selectedArea&&this.drawer.drawHighlight(this.secondsToPixels(b.startTime),this.secondsToPixels(b.endTime)),this.fire("changeshift")},isPlaying:function(){return this.playout.isPlaying()},setGainLevel:function(a){this.gain=a,this.playout.setGainLevel(a)},setMasterGainLevel:function(a){this.playout.setMasterGainLevel(a),a?this.container.classList.remove("silent"):this.container.classList.add("silent")},schedulePlay:function(a,b,c,d){var e,f,g,h,i=a,j=c?c-b:void 0,k=this.cues.cuein/this.sampleRate;return this.endTime<=b||j&&b+j<this.startTime?Promise.resolve():(this.startTime>=b?(e=0,i=i+this.startTime-b,c?(j-=this.startTime-b,f=Math.min(j,this.duration)):f=this.duration):(e=b-this.startTime,f=c?Math.min(j,this.duration-e):this.duration-e),e+=k,g=b-this.startTime,h=this.playout.setUpSource(),this.playout.applyFades(this.fades,g,a),this.playout.setGainLevel(this.gain),this.playout.setMasterGainLevel(d.masterGain),this.playout.play(i,e,f),h)},scheduleStop:function(a){this.playout.stop(a||this.config.getCurrentTime())},showProgress:function(a){this.drawer.updateProgress(this.secondsToPixels(a))},showSelection:function(){var a,b;a=this.secondsToPixels(this.selectedArea.startTime),b=this.secondsToPixels(this.selectedArea.endTime),this.drawer.drawHighlight(a,b)},getTrackDetails:function(){var a,b,c=this.cues,d=[];for(b in this.fades)d.push(this.fades[b]);return a={start:this.startTime,end:this.endTime,fades:d,src:this.src,cuein:this.samplesToSeconds(c.cuein),cueout:this.samplesToSeconds(c.cueout)}},destroy:function(){this.currentState&&this.currentState.leave.call(this)}},WaveformPlaylist.mixin(WaveformPlaylist.TrackEditor,WaveformPlaylist.unitConversions),WaveformPlaylist.WaveformDrawer={MAX_CANVAS_WIDTH:2e4,init:function(){WaveformPlaylist.makePublisher(this),this.container=document.createElement("div"),this.container.classList.add("channel-wrapper"),this.channels=[],this.pixelOffset=0,this.containerWidth=0;var a=this.config.getUITheme();return void 0!==this.loaderStates[a]?this.loaderStates=this.loaderStates[a]:this.loaderStates=this.loaderStates["default"],this.container},loaderStates:{bootstrap:{downloading:"progress-bar",decoding:"progress-bar progress-bar-striped",loader:"bar"},jQueryUI:{downloading:"ui-progressbar ui-widget ui-widget-content ui-corner-all",decoding:"ui-progressbar ui-widget ui-widget-content ui-corner-all",loader:"ui-progressbar-value ui-widget-header ui-corner-left"},"default":{downloading:"progress",decoding:"decoding",loader:"bar"}},getPeaks:function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this.config.getResolution(),n=[],o=b.cueout-b.cuein,p=Math.ceil(o/m),q=a.numberOfChannels,r=1/q,s=this.config.isDisplayMono(),t=-(1/0);for(c=0;p>c;c++){for(n[c]=[],d=0;q>d;d++){for(g=a.getChannelData(d),g=g.subarray(b.cuein,b.cueout),h=c*m,i=(c+1)*m>o?o:(c+1)*m,j=g.subarray(h,i),k=-(1/0),l=1/0,e=0,f=j.length;f>e;e++)j[e]>k&&(k=j[e]),j[e]<l&&(l=j[e]);n[c].push({max:k,min:l}),t=Math.max.apply(Math,[t,Math.abs(k),Math.abs(l)])}if(s){for(k=l=0,d=0;q>d;d++)k+=r*n[c][d].max,l+=r*n[c][d].min;n[c]=[],n[c].push({max:k,min:l})}}this.maxPeak=t,this.peaks=n},drawError:function(){this.container.innerHTML="",this.container.classList.add("error")},drawActive:function(){this.container.classList.add("active")},drawInactive:function(){this.container.classList.remove("active"),this.selection&&this.waveformContainer.removeChild(this.selection),this.selection=void 0},setPixelOffset:function(a){a+this.width;this.pixelOffset=a,this.drawTimeShift(),this.containerWidth=a+this.width},drawTimeShift:function(){var a,b;for(a=0,b=this.channels.length;b>a;a++)this.channels[a].div.style.left=this.pixelOffset+"px"},updateLoader:function(a){this.loader.style.width=a+"%"},setLoaderState:function(a){this.loader.className=this.loaderStates[a]},drawLoading:function(){var a,b;this.height=this.config.getWaveHeight(),a=document.createElement("div"),a.style.height=this.height+"px",b=document.createElement("div"),b.style.height="10px",b.className=this.loaderStates.loader,a.appendChild(b),this.loader=b,this.setLoaderState("downloading"),this.updateLoader(0),this.container.appendChild(a)},updateContainerWidth:function(a){this.container.style.width=a+"px",this.waveformContainer&&(this.waveformContainer.style.width=a+"px")},findClickedPixel:function(a){var b,c=a.target,d=0,e=0,f=a.layerX||a.offsetX;return"CANVAS"===c.tagName?(b=c.parentNode,d=b.offsetLeft,b.classList.contains("playlist-fade")?(b=b.parentNode,d+=b.offsetLeft):e=c.dataset.offset):c.classList.contains("selection")&&(d+=c.offsetLeft),d+f+e*this.MAX_CANVAS_WIDTH},drawTrackControls:function(a,b,c){var d,e,f,g,h,i,j;return d=document.createElement("div"),d.style.height=b+"px",d.style.width=a+"px",d.style.position="absolute",d.style.left=0,d.classList.add("controls"),d.style.zIndex=1e3,j=document.createElement("header"),j.textContent=c,e=document.createElement("div"),e.className="btn-group",f=document.createElement("span"),f.className="btn btn-default btn-xs btn-mute",f.textContent="Mute",g=document.createElement("span"),g.className="btn btn-default btn-xs btn-solo",g.textContent="Solo",h=document.createElement("input"),h.type="range",h.setAttribute("min",0),h.setAttribute("max",100),h.setAttribute("value",100),h.classList.add("volume-slider"),i=document.createElement("label"),i.appendChild(h),e.appendChild(f),e.appendChild(g),d.appendChild(j),d.appendChild(e),d.appendChild(i),this.container.style.marginLeft=a+"px",d},drawWaveform:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=0,n=0,o=this.config.isDisplayMono(),p=this.config.getResolution(),q=o?1:a.numberOfChannels,r=b.cueout-b.cuein+1,s=document.createDocumentFragment();for(this.waveformContainer.innerHTML="",this.channels=[],this.selection=void 0,this.width=Math.ceil(r/p),l=document.createElement("div"),l.classList.add("cursor"),l.style.position="absolute",l.style.boxSizing="content-box",l.style.margin=0,l.style.padding=0,l.style.top=0,l.style.left=0,l.style.bottom=0,l.style.zIndex=100,this.cursor=l,s.appendChild(l),g=0;q>g;g++){for(e=document.createElement("div"),e.classList.add("channel"),e.classList.add("channel-"+g),e.style.width=this.width+"px",e.style.height=this.height+"px",e.style.top=m+"px",e.style.left=n+"px",e.style.position="absolute",e.style.margin=0,e.style.padding=0,e.style.zIndex=1,f=document.createElement("div"),f.classList.add("channel-progress"),f.style.position="absolute",f.style.width=0,f.style.height=this.height+"px",f.style.zIndex=2,e.appendChild(f),i=0,h=[],k=0;i<this.width;)j=Math.min(this.MAX_CANVAS_WIDTH,this.width-i),d=document.createElement("canvas"),d.setAttribute("width",j),d.setAttribute("height",this.height),d.style.cssFloat="left",d.style.position="relative",d.style.margin=0,d.style.padding=0,d.style.zIndex=3,d.dataset.offset=k,e.appendChild(d),h.push(d),i+=j,k++;this.channels.push({canvas:h,div:e,progress:f}),s.appendChild(e),m+=this.height}this.getPeaks(a,b),this.draw(),this.drawTimeShift(),this.drawFades(c),this.waveformContainer.appendChild(s)},drawContainer:function(a,b,c,d){var e,f=this.config.isDisplayMono(),g=this.config.getResolution(),h=f?1:a.numberOfChannels,i=b.cueout-b.cuein+1,j=document.createDocumentFragment(),k=h*this.height,l=this.config.getControlSettings();this.container.innerHTML="",this.width=Math.ceil(i/g),l.show&&j.appendChild(this.drawTrackControls(l.width,k,d)),e=document.createElement("div"),e.classList.add("waveform"),e.style.height=k+"px",e.style.width=this.width+"px",e.style.position="relative",this.waveformContainer=e,this.drawWaveform(a,b,c),j.appendChild(e),this.container.style.height=k+"px",this.container.appendChild(j)},drawFrame:function(a,b,c){var d,e,f,g=this.height/2,h=Math.floor(b/this.MAX_CANVAS_WIDTH),i=this.channels[a].canvas[h].getContext("2d"),j=this.config.getColorScheme();e=Math.abs(c.max*g),f=Math.abs(c.min*g),d=b-h*this.MAX_CANVAS_WIDTH,i.fillStyle=j.waveOutlineColor,i.fillRect(d,0,1,g-e),i.fillRect(d,g+f,1,g-f)},draw:function(a,b){var c=this,d=this.peaks,e=this.pixelOffset,f=a?a-e:0,g=b?b-e+1:d.length;if(!(0>f&&0>g))for(0>f&&(f=0),g>d.length&&(g=d.length);g>f;f++)d[f].forEach(function(a,b){c.drawFrame(b,f,a)})},updateProgress:function(a){this.drawProgress(a),this.drawCursor(a)},drawProgress:function(a){var b,c,d=Math.max(a-this.pixelOffset,0),e=Math.min(d,this.width);for(b=0,c=this.channels.length;c>b;b++)this.channels[b].progress.style.width=e+"px"},drawCursor:function(a){this.cursor.style.width=a+"px"},drawHighlight:function(a,b){var c,d=b-a+1,e=this.selection||document.createElement("div");c=1===d?"selection-cursor":"selection-segment",e.className="",e.classList.add(c),e.classList.add("selection"),e.style.position="absolute",e.style.width=d+"px",e.style.bottom=0,e.style.top=0,e.style.left=a+"px",e.style.zIndex=999,void 0===this.selection&&(this.waveformContainer.appendChild(e),this.selection=e)},sCurveFadeIn:function(a){return this.createSCurveBuffer(a,Math.PI/2)},sCurveFadeOut:function(a){return this.createSCurveBuffer(a,-(Math.PI/2))},logarithmicFadeIn:function(a){return this.createLogarithmicBuffer(a,10,1)},logarithmicFadeOut:function(a){return this.createLogarithmicBuffer(a,10,-1)},exponentialFadeIn:function(a){return this.createExponentialBuffer(a,1)},exponentialFadeOut:function(a){return this.createExponentialBuffer(a,-1)},linearFadeIn:function(a){return this.createLinearBuffer(a,1)},linearFadeOut:function(a){return this.createLinearBuffer(a,-1)},drawFadeCurve:function(a,b,c,d){var e,f,g,h,i=b+c,j=this[i],k=this.config.getColorScheme(),l=this.height;for(a.strokeStyle=k.fadeColor,e=j.call(this,d),h=l-e[0]*l,a.beginPath(),a.moveTo(0,h),f=1,g=e.length;g>f;f++)h=l-e[f]*l,a.lineTo(f,h);a.stroke()},removeFade:function(a){var b,c,d,e,f="playlist-fade-"+a;if(c=this.container.getElementsByClassName(f),e=c.length,e>0)for(d=e-1;d>=0;d--)b=c[d],b.parentNode.removeChild(b)},drawFade:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o=document.createDocumentFragment();if(e-d!==0)for(h=~~(e-d+1),i=d,f=document.createElement("div"),f.classList.add("playlist-fade"),f.classList.add("playlist-fade-"+a),f.style.position="absolute",f.style.width=h+"px",f.style.height=this.height+"px",f.style.top=0,f.style.left=i+"px",f.style.zIndex=1e3,g=document.createElement("canvas"),g.setAttribute("width",h),g.setAttribute("height",this.height),m=g.getContext("2d"),this.drawFadeCurve(m,c,b,h),f.appendChild(g),o.appendChild(f),j=0,k=this.channels.length;k>j;j++)l=o.cloneNode(!0),n=l.querySelector("canvas").getContext("2d"),n.drawImage(g,0,0),this.channels[j].div.appendChild(l)},drawFades:function(a){var b,c,d,e,f=this.config.getSampleRate(),g=this.config.getResolution();for(b in a)c=a[b],a.hasOwnProperty(b)&&(d=c.start*f/g,e=c.end*f/g,this.drawFade(b,c.type,c.shape,d,e))}},WaveformPlaylist.mixin(WaveformPlaylist.WaveformDrawer,WaveformPlaylist.curves);